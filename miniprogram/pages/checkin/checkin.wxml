<!-- pages/checkin/checkin.wxml -->
<view class="page-container" wx:if="{{!loading}}">
  <!-- ä¹ æƒ¯ä¿¡æ¯å¡ç‰‡ -->
  <view class="habit-header" style="background: linear-gradient(135deg, {{habit.color || '#6C5CE7'}} 0%, {{habit.color || '#6C5CE7'}}CC 100%)">
    <view class="habit-icon-wrapper">
      <text class="habit-icon">{{habit.icon || 'ğŸ¯'}}</text>
    </view>
    <view class="habit-info">
      <text class="habit-name">{{habit.name || 'ä¹ æƒ¯'}}</text>
      <text class="habit-desc" wx:if="{{habit.description}}">{{habit.description}}</text>
      <view class="habit-target" wx:if="{{habit.targetValue}}">
        <text class="target-text">ç›®æ ‡ï¼š{{habit.targetValue}} {{habit.unit || ''}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¥æœŸæ˜¾ç¤º -->
  <view class="date-card">
    <view class="date-icon">ğŸ“…</view>
    <view class="date-info">
      <text class="date-label">æ‰“å¡æ—¥æœŸ</text>
      <text class="date-value">{{dateDisplay}}</text>
    </view>
    <view class="date-status" wx:if="{{existingCheckIn}}">
      <text class="status-tag">å·²æ‰“å¡</text>
    </view>
  </view>

  <!-- æ‰“å¡è¡¨å• -->
  <view class="form-container">
    <!-- å¿«é€Ÿå®ŒæˆæŒ‰é’® -->
    <view class="quick-complete-section">
      <view
        class="quick-complete-btn {{completed ? 'completed' : ''}}"
        style="{{completed ? 'background: linear-gradient(135deg, ' + (habit.color || '#6C5CE7') + ' 0%, ' + (habit.color || '#6C5CE7') + 'CC 100%)' : ''}}"
        bindtap="onQuickComplete"
      >
        <view class="complete-icon-wrapper">
          <text class="complete-icon">{{completed ? 'âœ“' : 'â—‹'}}</text>
        </view>
        <text class="complete-text">{{completed ? 'å·²å®Œæˆ' : 'ç‚¹å‡»å®Œæˆ'}}</text>
      </view>
    </view>

    <!-- å®Œæˆæ•°é‡ï¼ˆå¦‚æœæœ‰å•ä½ï¼‰ -->
    <view class="form-card" wx:if="{{habit.unit || habit.targetValue}}">
      <view class="form-section-title">
        <text class="section-icon">ğŸ“Š</text>
        <text>å®Œæˆæ•°é‡</text>
      </view>
      <view class="value-input-group">
        <view class="value-btn" bindtap="onValueDecrease">
          <text class="value-btn-icon">âˆ’</text>
        </view>
        <view class="value-input-wrapper">
          <input
            class="value-input"
            type="digit"
            placeholder="0"
            value="{{value}}"
            bindinput="onValueInput"
          />
          <text class="value-unit" wx:if="{{habit.unit}}">{{habit.unit}}</text>
        </view>
        <view class="value-btn" bindtap="onValueIncrease">
          <text class="value-btn-icon">+</text>
        </view>
      </view>
      <!-- ç›®æ ‡è¿›åº¦ -->
      <view class="progress-hint" wx:if="{{habit.targetValue && value}}">
        <view class="progress-bar-bg">
          <view
            class="progress-bar-fill"
            style="width: {{value / habit.targetValue * 100 > 100 ? 100 : value / habit.targetValue * 100}}%; background-color: {{habit.color || '#6C5CE7'}}"
          ></view>
        </view>
        <text class="progress-text">{{value}} / {{habit.targetValue}} {{habit.unit || ''}}</text>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="form-card">
      <view class="form-section-title">
        <text class="section-icon">ğŸ“</text>
        <text>æ‰“å¡å¤‡æ³¨</text>
        <text class="optional-tag">é€‰å¡«</text>
      </view>
      <textarea
        class="note-textarea"
        placeholder="è®°å½•ä»Šå¤©çš„æ„Ÿå—ã€å¿ƒå¾—..."
        value="{{note}}"
        bindinput="onNoteInput"
        maxlength="200"
        auto-height
      />
      <view class="note-counter">{{note.length}}/200</view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="bottom-actions">
    <button
      class="submit-btn"
      style="background: linear-gradient(135deg, {{habit.color || '#6C5CE7'}} 0%, {{habit.color || '#6C5CE7'}}CC 100%)"
      bindtap="onSubmit"
      disabled="{{saving}}"
    >
      {{saving ? 'ä¿å­˜ä¸­...' : (existingCheckIn ? 'æ›´æ–°æ‰“å¡' : 'ä¿å­˜æ‰“å¡')}}
    </button>

    <view class="delete-btn" wx:if="{{existingCheckIn}}" bindtap="onDelete">
      <text class="delete-text">åˆ é™¤è®°å½•</text>
    </view>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-container" wx:else>
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
