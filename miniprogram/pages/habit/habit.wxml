<!-- pages/habit/habit.wxml -->
<view class="page-container">
  <!-- 预览卡片 -->
  <view class="preview-card" style="border-left: 8rpx solid {{color}}">
    <view class="preview-icon" style="background-color: {{color}}20" bindtap="openIconPicker">
      <text class="preview-icon-text">{{icon}}</text>
      <view class="preview-icon-edit">
        <text class="edit-hint">点击更换</text>
      </view>
    </view>
    <view class="preview-info">
      <text class="preview-name">{{name || '习惯名称'}}</text>
      <text class="preview-desc">{{description || '添加描述'}}</text>
    </view>
  </view>

  <!-- 表单 -->
  <view class="form-container">
    <!-- 习惯名称 -->
    <view class="form-card">
      <view class="form-item">
        <view class="form-label-row">
          <text class="form-label">习惯名称</text>
          <text class="form-required">*</text>
        </view>
        <input
          class="form-input"
          placeholder="例如：跑步、阅读、冥想"
          value="{{name}}"
          bindinput="onNameInput"
          maxlength="20"
        />
      </view>

      <view class="form-item">
        <view class="form-label-row">
          <text class="form-label">描述</text>
        </view>
        <textarea
          class="form-textarea"
          placeholder="简单描述这个习惯（选填）"
          value="{{description}}"
          bindinput="onDescInput"
          maxlength="100"
          auto-height
        />
      </view>
    </view>

    <!-- 目标设置 -->
    <view class="form-card">
      <view class="section-title">目标设置（选填）</view>

      <view class="form-row">
        <view class="form-item half">
          <text class="form-label">目标值</text>
          <input
            class="form-input"
            type="digit"
            placeholder="如：5"
            value="{{targetValue}}"
            bindinput="onTargetInput"
          />
        </view>
        <view class="form-item half">
          <text class="form-label">单位</text>
          <input
            class="form-input"
            placeholder="如：公里"
            value="{{unit}}"
            bindinput="onUnitInput"
            maxlength="5"
          />
        </view>
      </view>
    </view>

    <!-- 主题颜色 -->
    <view class="form-card">
      <view class="section-title">主题颜色</view>
      <view class="color-picker">
        <view
          wx:for="{{colors}}"
          wx:key="value"
          class="color-item {{color === item.value ? 'active' : ''}}"
          style="background-color: {{item.value}}"
          bindtap="onColorSelect"
          data-color="{{item.value}}"
        >
          <text wx:if="{{color === item.value}}" class="color-check">✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view class="submit-container">
    <button class="submit-btn" style="background: linear-gradient(135deg, {{color}} 0%, {{color}}CC 100%)" bindtap="onSubmit">
      {{isEdit ? '保存修改' : '创建习惯'}}
    </button>
  </view>

  <!-- 图标选择器 -->
  <icon-picker
    show="{{showIconPicker}}"
    selected="{{icon}}"
    bind:select="onIconSelect"
    bind:close="closeIconPicker"
  />
</view>
