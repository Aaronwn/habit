<!-- pages/habit/habit.wxml -->
<view class="page-container">
  <!-- 预览卡片 -->
  <view class="preview-card" style="border-left: 8rpx solid {{color}}">
    <view class="preview-icon" style="background-color: {{color}}20" bindtap="openIconPicker">
      <text class="preview-icon-text">{{icon}}</text>
      <view class="preview-icon-edit">
        <text class="edit-hint">点击更换</text>
      </view>
    </view>
    <view class="preview-info">
      <text class="preview-name">{{name || '习惯名称'}}</text>
      <text class="preview-desc">{{frequencyType === 'daily' ? '每天打卡' : '每周' + timesPerWeek + '次'}}</text>
    </view>
  </view>

  <!-- 表单 -->
  <view class="form-container">
    <!-- 习惯名称 -->
    <view class="form-card">
      <view class="form-item">
        <view class="form-label-row">
          <text class="form-label">习惯名称</text>
          <text class="form-required">*</text>
        </view>
        <input
          class="form-input"
          placeholder="例如：跑步、阅读、冥想"
          value="{{name}}"
          bindinput="onNameInput"
          maxlength="20"
        />
      </view>
    </view>

    <!-- 打卡频率 -->
    <view class="form-card">
      <view class="section-title">打卡频率</view>

      <!-- 频率类型选择 -->
      <view class="frequency-selector">
        <view
          class="freq-option {{frequencyType === 'daily' ? 'active' : ''}}"
          style="{{frequencyType === 'daily' ? 'background-color:' + color : ''}}"
          bindtap="onFrequencyTypeChange"
          data-type="daily"
        >每天</view>
        <view
          class="freq-option {{frequencyType === 'weekly' ? 'active' : ''}}"
          style="{{frequencyType === 'weekly' ? 'background-color:' + color : ''}}"
          bindtap="onFrequencyTypeChange"
          data-type="weekly"
        >每周</view>
      </view>

      <!-- 每周次数选择（仅 weekly 显示） -->
      <view wx:if="{{frequencyType === 'weekly'}}" class="times-selector">
        <text class="times-label">每周打卡</text>
        <picker
          mode="selector"
          range="{{timesOptions}}"
          value="{{timesPerWeek - 1}}"
          bindchange="onTimesChange"
        >
          <view class="times-picker">{{timesPerWeek}} 次 ▼</view>
        </picker>
      </view>
    </view>

    <!-- 主题颜色 -->
    <view class="form-card">
      <view class="section-title">主题颜色</view>
      <view class="color-picker">
        <view
          wx:for="{{colors}}"
          wx:key="value"
          class="color-item {{color === item.value ? 'active' : ''}}"
          style="background-color: {{item.value}}"
          bindtap="onColorSelect"
          data-color="{{item.value}}"
        >
          <text wx:if="{{color === item.value}}" class="color-check">✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view class="submit-container">
    <button class="submit-btn" style="background: linear-gradient(135deg, {{color}} 0%, {{color}}CC 100%)" bindtap="onSubmit">
      {{isEdit ? '保存修改' : '创建习惯'}}
    </button>
  </view>

  <!-- 图标选择器 -->
  <icon-picker
    show="{{showIconPicker}}"
    selected="{{icon}}"
    bind:select="onIconSelect"
    bind:close="closeIconPicker"
  />
</view>
