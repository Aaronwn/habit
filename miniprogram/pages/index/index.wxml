<!-- pages/index/index.wxml -->
<view class="page-container">
  <!-- 顶部头部 -->
  <view class="header">
    <view class="header-content">
      <view class="date-section">
        <text class="date-main">{{todayFormatted}}</text>
        <text class="date-week">{{weekDay}}</text>
      </view>
      <view class="progress-section" wx:if="{{totalCount > 0}}">
        <text class="progress-text">{{completedCount}}/{{totalCount}}</text>
        <text class="progress-label">今日完成</text>
      </view>
    </view>
    <view class="header-slogan">
      <text>坚持每一天，成就更好的自己</text>
    </view>
  </view>

  <!-- 习惯列表 -->
  <view class="habits-container">
    <!-- 骨架屏加载状态 -->
    <block wx:if="{{loading}}">
      <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-icon skeleton"></view>
        <view class="skeleton-content">
          <view class="skeleton-title skeleton"></view>
          <view class="skeleton-desc skeleton"></view>
        </view>
        <view class="skeleton-btn skeleton"></view>
      </view>
    </block>

    <!-- 习惯列表 -->
    <block wx:elif="{{habits.length > 0}}">
      <block wx:for="{{habits}}" wx:key="_id">
        <habit-card
          habit="{{item}}"
          checkIn="{{todayCheckIns[item._id]}}"
          streak="{{streaks[item._id] || 0}}"
          bind:tap="onHabitTap"
          bind:longpress="onHabitLongPress"
          bind:quickcheckin="onQuickCheckIn"
        />
      </block>
    </block>

    <!-- 空状态 -->
    <view wx:else class="empty-state">
      <view class="empty-illustration">
        <text class="empty-icon">🎯</text>
      </view>
      <view class="empty-title">开启你的习惯之旅</view>
      <view class="empty-desc">点击下方按钮，创建你的第一个习惯</view>
      <view class="empty-action" bindtap="goToAddHabit">
        <text class="empty-action-text">+ 添加习惯</text>
      </view>
    </view>
  </view>

  <!-- 添加习惯按钮 -->
  <view class="add-button" bindtap="goToAddHabit" wx:if="{{habits.length > 0}}">
    <text class="add-icon">+</text>
  </view>
</view>
