<!-- pages/stats/stats.wxml -->
<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-title">
      <text class="title-icon">ğŸ“Š</text>
      <text class="title-text">æ•°æ®ç»Ÿè®¡</text>
    </view>
    <picker
      mode="selector"
      range="{{timeRangeOptions}}"
      range-key="label"
      bindchange="onTimeRangeChange"
    >
      <view class="time-range-picker">
        <text class="picker-text">{{timeRangeOptions[timeRange === 'week' ? 0 : (timeRange === 'month' ? 1 : 2)].label}}</text>
        <text class="picker-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <block wx:else>
    <!-- æ€»è§ˆå¡ç‰‡ -->
    <view class="overview-section">
      <view class="stats-grid">
        <stats-card
          title="ç´¯è®¡æ‰“å¡"
          value="{{totalCheckIns}}"
          unit="æ¬¡"
          icon="ğŸ“Š"
          color="#6C5CE7"
        />
        <stats-card
          title="å½“å‰è¿ç»­"
          value="{{currentStreak}}"
          unit="å¤©"
          icon="ğŸ”¥"
          color="#FF6B6B"
        />
        <stats-card
          title="æœ€é•¿è¿ç»­"
          value="{{longestStreak}}"
          unit="å¤©"
          icon="ğŸ†"
          color="#FDCB6E"
        />
        <stats-card
          title="æ‰“å¡ç‡"
          value="{{checkInRate}}"
          unit="%"
          icon="ğŸ“ˆ"
          color="#00B894"
        />
      </view>
    </view>

    <!-- æœ¬å‘¨è¶‹åŠ¿ -->
    <view class="week-chart-section">
      <view class="section-header">
        <text class="section-title">æœ¬å‘¨è¶‹åŠ¿</text>
      </view>
      <view class="week-chart">
        <view class="chart-bars">
          <view
            wx:for="{{weekData}}"
            wx:key="date"
            class="bar-item {{item.isToday ? 'today' : ''}}"
          >
            <view class="bar-wrapper">
              <view
                class="bar-fill"
                style="height: {{item.rate > 0 ? item.rate : 5}}%"
              ></view>
            </view>
            <text class="bar-label">{{weekLabels[index]}}</text>
            <text class="bar-value">{{item.count}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¹ æƒ¯è¯¦ç»†ç»Ÿè®¡ -->
    <view class="habits-stats-section">
      <view class="section-header">
        <text class="section-title">ä¹ æƒ¯ç»Ÿè®¡</text>
        <text class="section-subtitle">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
      </view>

      <view wx:if="{{habitsStats.length > 0}}" class="habits-stats-list">
        <view
          wx:for="{{habitsStats}}"
          wx:key="habitId"
          class="habit-stat-item"
          data-habitid="{{item.habitId}}"
          bindtap="onHabitStatTap"
        >
          <view class="habit-stat-header">
            <view class="habit-icon-wrapper" style="background-color: {{item.color}}20">
              <text class="habit-icon">{{item.icon}}</text>
            </view>
            <view class="habit-info">
              <text class="habit-name">{{item.name}}</text>
              <view class="habit-meta">
                <text class="meta-item">ğŸ”¥ {{item.currentStreak}}å¤©</text>
                <text class="meta-item">âœ“ {{item.totalCheckIns}}æ¬¡</text>
              </view>
            </view>
            <text class="habit-arrow">â€º</text>
          </view>

          <!-- è¿›åº¦æ¡ -->
          <view class="habit-progress">
            <view class="progress-bar-bg">
              <view
                class="progress-bar-fill"
                style="width: {{item.rate}}%; background-color: {{item.color}}"
              ></view>
            </view>
            <text class="progress-text" style="color: {{item.color}}">{{item.rate}}%</text>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-state">
        <view class="empty-illustration">
          <text class="empty-emoji">ğŸ“ˆ</text>
        </view>
        <text class="empty-title">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
        <text class="empty-desc">åˆ›å»ºä¹ æƒ¯å¹¶å¼€å§‹æ‰“å¡åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯</text>
      </view>
    </view>

    <!-- å°è´´å£« -->
    <view class="tips-section" wx:if="{{habitsStats.length > 0}}">
      <view class="tip-card">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">åšæŒæ¯å¤©æ‰“å¡ï¼Œå…»æˆå¥½ä¹ æƒ¯ï¼è¿ç»­æ‰“å¡å¤©æ•°è¶Šå¤šï¼Œæˆå°±æ„Ÿè¶Šå¼ºå“¦~</text>
      </view>
    </view>
  </block>
</view>
